<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Madeline & Jake ‚Äî May 1, 2027</title>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;1,300;1,400&family=DM+Mono:wght@300;400&display=swap" rel="stylesheet" />
  <style>
    :root {
      --cream:#faf7f2;--charcoal:#1a1a1a;--coral:#ff5f3f;
      --yellow:#f7d94c;--teal:#2ec4b6;--pink:#ff85a1;
      --violet:#7c5cbf;--green:#4caf82;
    }
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
    html{scroll-behavior:smooth}
    body{font-family:'Cormorant Garamond',serif;background:var(--cream);color:var(--charcoal);overflow-x:hidden}

    nav{position:fixed;top:0;left:0;right:0;z-index:100;display:flex;justify-content:center;gap:2.5rem;padding:1.2rem 2rem;background:var(--cream);border-bottom:1.5px solid var(--charcoal);font-family:'DM Mono',monospace;font-size:0.72rem;letter-spacing:0.12em;text-transform:uppercase}
    nav a{color:var(--charcoal);text-decoration:none;transition:color .2s}
    nav a:hover{color:var(--coral)}
    #admin-nav-link{display:none;color:var(--coral)}

    #hero{min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:8rem 2rem 4rem;position:relative;overflow:hidden}
    .confetti-strip{position:absolute;top:0;left:0;right:0;height:10px;background:repeating-linear-gradient(90deg,var(--coral) 0,var(--coral) 60px,var(--yellow) 60px,var(--yellow) 120px,var(--teal) 120px,var(--teal) 180px,var(--pink) 180px,var(--pink) 240px,var(--violet) 240px,var(--violet) 300px,var(--green) 300px,var(--green) 360px)}
    .fs{position:absolute;border-radius:50%;opacity:.12;animation:float 8s ease-in-out infinite}
    .s1{width:320px;height:320px;background:var(--coral);top:10%;left:2%;animation-delay:0s}
    .s2{width:200px;height:200px;background:var(--yellow);top:60%;right:2%;animation-delay:2s}
    .s3{width:150px;height:150px;background:var(--teal);bottom:10%;left:20%;animation-delay:4s}
    @keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-24px)}}
    .hero-eyebrow{font-family:'DM Mono',monospace;font-size:.75rem;letter-spacing:.2em;text-transform:uppercase;color:var(--coral);margin-bottom:1.5rem;animation:fadeUp .8s ease both}
    .hero-names{font-size:clamp(4rem,12vw,9rem);font-weight:300;line-height:.9;text-align:center;letter-spacing:-.02em;animation:fadeUp .8s .15s ease both}
    .hero-names .amp{color:var(--coral);font-style:italic;display:block;font-size:.6em}
    .hero-date{margin-top:2.5rem;font-family:'DM Mono',monospace;font-size:.85rem;letter-spacing:.15em;text-transform:uppercase;border:1.5px solid var(--charcoal);padding:.7rem 2rem;animation:fadeUp .8s .3s ease both}
    .hero-loc{margin-top:1rem;font-size:1.1rem;font-style:italic;color:#555;animation:fadeUp .8s .45s ease both}
    .dc-badge{margin-top:3rem;background:var(--yellow);border:1.5px solid var(--charcoal);padding:.9rem 1.8rem;font-family:'DM Mono',monospace;font-size:.72rem;letter-spacing:.08em;text-align:center;max-width:380px;animation:fadeUp .8s .6s ease both}
    .dc-badge strong{display:block;font-size:.85rem;margin-bottom:.2rem}
    @keyframes fadeUp{from{opacity:0;transform:translateY(24px)}to{opacity:1;transform:translateY(0)}}

    section{padding:6rem 2rem;max-width:900px;margin:0 auto}
    .section-label{font-family:'DM Mono',monospace;font-size:.7rem;letter-spacing:.2em;text-transform:uppercase;color:var(--coral);margin-bottom:.8rem}
    .section-title{font-size:clamp(2.2rem,5vw,3.5rem);font-weight:300;line-height:1.1;margin-bottom:2.5rem}
    .divider{width:100%;height:1.5px;background:repeating-linear-gradient(90deg,var(--coral) 0,var(--coral) 30px,transparent 30px,transparent 40px,var(--teal) 40px,var(--teal) 70px,transparent 70px,transparent 80px,var(--yellow) 80px,var(--yellow) 110px,transparent 110px,transparent 120px);margin:4rem 0}

    .sched-grid{display:grid;gap:0}
    .ev-block{display:grid;grid-template-columns:140px 1fr;gap:1.5rem;padding:2rem 0;border-bottom:1px solid #ddd;align-items:start}
    .ev-block:first-child{border-top:1px solid #ddd}
    .ev-time{font-family:'DM Mono',monospace;font-size:.78rem;letter-spacing:.08em;padding-top:.3rem}
    .ev-dot{display:inline-block;width:10px;height:10px;border-radius:50%;margin-right:.4rem;vertical-align:middle}
    .ev-name{font-size:1.4rem;font-weight:400;margin-bottom:.3rem}
    .ev-det{font-size:1rem;color:#666;font-style:italic}
    .ev-day{font-family:'DM Mono',monospace;font-size:.7rem;letter-spacing:.18em;text-transform:uppercase;background:var(--charcoal);color:var(--cream);padding:.6rem 1rem}

    /* ‚îÄ‚îÄ RSVP ‚îÄ‚îÄ */
    .rsvp-box{border:1.5px solid var(--charcoal);padding:3rem}
    .rsvp-step{display:none}
    .rsvp-step.active{display:block}

    .form-group{display:flex;flex-direction:column;gap:.4rem;margin-bottom:1.2rem}
    label{font-family:'DM Mono',monospace;font-size:.68rem;letter-spacing:.15em;text-transform:uppercase}
    input,select,textarea{font-family:'Cormorant Garamond',serif;font-size:1rem;border:1px solid #ccc;padding:.7rem .9rem;background:var(--cream);color:var(--charcoal);outline:none;transition:border-color .2s;width:100%}
    input:focus,select:focus,textarea:focus{border-color:var(--coral)}
    textarea{resize:vertical;min-height:80px}

    .btn{font-family:'DM Mono',monospace;font-size:.78rem;letter-spacing:.12em;text-transform:uppercase;background:var(--coral);color:white;border:none;padding:1rem 2.5rem;cursor:pointer;transition:background .2s,transform .1s}
    .btn:hover{background:#e04a2e;transform:translateY(-1px)}
    .btn:active{transform:translateY(0)}
    .btn:disabled{background:#ccc;cursor:not-allowed;transform:none}
    .btn-ghost{background:transparent;color:var(--charcoal);border:1.5px solid var(--charcoal)}
    .btn-ghost:hover{background:var(--charcoal);color:var(--cream)}
    .btn-row{display:flex;gap:1rem;flex-wrap:wrap;margin-top:1.5rem}

    .alert{padding:.9rem 1.2rem;font-family:'DM Mono',monospace;font-size:.75rem;letter-spacing:.06em;margin-bottom:1.2rem}
    .alert-error{background:#ffeaea;border:1px solid var(--coral);color:#c0392b}
    .alert-info{background:#fffbea;border:1px solid var(--yellow);color:#7a6000}
    .alert-success{background:#eafaf4;border:1px solid var(--green);color:#1a7a4a}

    /* invitation found card */
    .inv-card{background:var(--yellow);border:1.5px solid var(--charcoal);padding:1.5rem;margin-bottom:2rem}
    .inv-card strong{font-family:'DM Mono',monospace;font-size:.7rem;letter-spacing:.1em;text-transform:uppercase;display:block;margin-bottom:.4rem}
    .inv-names{font-size:1.5rem;font-weight:400;line-height:1.3}

    /* per-person rows */
    .person-block{border:1.5px solid #ddd;margin-bottom:1rem;overflow:hidden}
    .person-header{background:var(--charcoal);color:var(--cream);padding:.7rem 1.2rem;font-size:1.1rem;display:flex;align-items:center;gap:.8rem}
    .person-role{font-family:'DM Mono',monospace;font-size:.6rem;letter-spacing:.1em;text-transform:uppercase;color:rgba(255,255,255,.45);margin-left:auto}
    .person-body{padding:1.2rem 1.5rem}
    .person-events{display:grid;grid-template-columns:1fr 1fr;gap:1rem}

    .event-toggle{border:1.5px solid #ddd;padding:1rem;cursor:pointer;text-align:center;transition:all .15s;user-select:none}
    .event-toggle:hover{border-color:var(--coral)}
    .event-toggle.selected-yes{background:var(--green);border-color:var(--green);color:white}
    .event-toggle.selected-no{background:#eee;border-color:#ccc;color:#999}
    .event-toggle .ev-label{font-family:'DM Mono',monospace;font-size:.65rem;letter-spacing:.1em;text-transform:uppercase;display:block;margin-bottom:.3rem;opacity:.7}
    .event-toggle .ev-answer{font-size:1.1rem;font-weight:400}

    /* plus one adder */
    .plus-one-box{border:1.5px dashed var(--teal);padding:1.5rem;margin-bottom:1rem;background:rgba(46,196,182,.04)}
    .plus-one-box .pob-label{font-family:'DM Mono',monospace;font-size:.7rem;letter-spacing:.12em;text-transform:uppercase;color:var(--teal);margin-bottom:.8rem}

    .rsvp-deadline{font-family:'DM Mono',monospace;font-size:.7rem;letter-spacing:.1em;color:#888;margin-top:1.5rem}
    .success-banner{background:var(--green);color:white;padding:2rem;font-family:'DM Mono',monospace;font-size:.82rem;letter-spacing:.08em;line-height:1.8}

    .spinner{display:inline-block;width:13px;height:13px;border:2px solid rgba(255,255,255,.3);border-top-color:white;border-radius:50%;animation:spin .7s linear infinite;vertical-align:middle;margin-right:6px}
    @keyframes spin{to{transform:rotate(360deg)}}

    /* ‚îÄ‚îÄ TRAVEL ‚îÄ‚îÄ */
    .hotel-cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:1.5rem;margin-top:1.5rem}
    .hotel-card{border:1.5px solid var(--charcoal);padding:1.8rem;position:relative;overflow:hidden}
    .hotel-card::before{content:'';position:absolute;top:0;left:0;width:100%;height:5px}
    .hotel-card:nth-child(1)::before{background:var(--coral)}
    .hotel-card:nth-child(2)::before{background:var(--teal)}
    .hotel-card:nth-child(3)::before{background:var(--yellow)}
    .hotel-name{font-size:1.3rem;margin-bottom:.3rem}
    .hotel-meta{font-family:'DM Mono',monospace;font-size:.68rem;letter-spacing:.1em;color:#888;margin-bottom:.8rem}
    .hotel-desc{font-size:.95rem;color:#555;font-style:italic;line-height:1.5}
    .travel-note{margin-top:2.5rem;padding:1.5rem;background:var(--yellow);border:1.5px solid var(--charcoal);font-size:1rem;line-height:1.6}
    .travel-note strong{font-family:'DM Mono',monospace;font-size:.72rem;letter-spacing:.12em;text-transform:uppercase;display:block;margin-bottom:.4rem}

    /* ‚îÄ‚îÄ ADMIN ‚îÄ‚îÄ */
    #admin{display:none;background:var(--charcoal);color:var(--cream);padding:6rem 2rem}
    #admin .inner{max-width:960px;margin:0 auto}
    #admin .section-label{color:var(--yellow)}
    #admin .section-title{color:var(--cream)}

    .script-row{display:flex;gap:.8rem;flex-wrap:wrap;margin-bottom:.5rem}
    .admin-input{font-family:'DM Mono',monospace;font-size:.75rem;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.2);color:var(--cream);padding:.7rem 1rem;outline:none;flex:1;min-width:260px}
    .admin-input:focus{border-color:var(--yellow)}
    .admin-input::placeholder{color:rgba(255,255,255,.25)}
    .btn-outline{font-family:'DM Mono',monospace;font-size:.72rem;letter-spacing:.1em;text-transform:uppercase;background:transparent;color:var(--cream);border:1.5px solid rgba(255,255,255,.25);padding:.7rem 1.5rem;cursor:pointer;transition:all .2s;white-space:nowrap}
    .btn-outline:hover{border-color:var(--yellow);color:var(--yellow)}
    .btn-outline.active{background:var(--yellow);color:var(--charcoal);border-color:var(--yellow)}
    .sync-status{font-family:'DM Mono',monospace;font-size:.68rem;letter-spacing:.08em;color:rgba(255,255,255,.4);min-height:1.2em;margin-bottom:1.5rem}

    .upload-zone{border:2px dashed rgba(255,255,255,.2);padding:2.5rem;text-align:center;cursor:pointer;transition:border-color .2s,background .2s;margin-bottom:1rem;position:relative}
    .upload-zone:hover{border-color:var(--yellow);background:rgba(247,217,76,.05)}
    .upload-zone-icon{font-size:2rem;margin-bottom:.5rem}
    .upload-zone-text{font-family:'DM Mono',monospace;font-size:.78rem;letter-spacing:.1em;color:rgba(255,255,255,.5)}
    .upload-zone-text strong{color:var(--yellow);display:block;margin-bottom:.3rem}
    .csv-hint{font-family:'DM Mono',monospace;font-size:.67rem;letter-spacing:.07em;color:rgba(255,255,255,.3);margin-bottom:2rem;line-height:1.9}
    .csv-hint code{background:rgba(255,255,255,.08);padding:.1rem .4rem;border-radius:2px;color:var(--yellow)}

    .admin-stats{display:none;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:1rem;margin-bottom:2.5rem}
    .stat-box{border:1px solid rgba(255,255,255,.1);padding:1.2rem 1.5rem}
    .stat-num{font-size:2.4rem;font-weight:300;line-height:1}
    .stat-label{font-family:'DM Mono',monospace;font-size:.62rem;letter-spacing:.1em;text-transform:uppercase;color:rgba(255,255,255,.35);margin-top:.3rem}

    #admin-controls{display:none}
    .admin-actions{display:flex;gap:.8rem;flex-wrap:wrap;margin-bottom:1.5rem}
    .search-bar{font-family:'DM Mono',monospace;font-size:.78rem;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.15);color:var(--cream);padding:.7rem 1rem;letter-spacing:.05em;width:100%;max-width:320px;outline:none;margin-bottom:1.5rem}
    .search-bar::placeholder{color:rgba(255,255,255,.25)}
    .search-bar:focus{border-color:var(--yellow)}
    .gtw{overflow-x:auto}
    table{width:100%;border-collapse:collapse;font-size:.88rem}
    th{font-family:'DM Mono',monospace;font-size:.62rem;letter-spacing:.12em;text-transform:uppercase;padding:.7rem 1rem;text-align:left;border-bottom:1px solid rgba(255,255,255,.1);color:rgba(255,255,255,.4)}
    td{padding:.65rem 1rem;border-bottom:1px solid rgba(255,255,255,.06);vertical-align:middle}
    tr.inv-row td{background:rgba(255,255,255,.03);font-family:'DM Mono',monospace;font-size:.65rem;letter-spacing:.08em;text-transform:uppercase;color:rgba(255,255,255,.3);padding:.4rem 1rem}
    .badge{display:inline-block;font-family:'DM Mono',monospace;font-size:.6rem;letter-spacing:.08em;padding:.2rem .55rem;border-radius:2px;text-transform:uppercase;white-space:nowrap}
    .b-yes{background:rgba(76,175,130,.2);color:var(--green)}
    .b-no{background:rgba(255,255,255,.07);color:rgba(255,255,255,.35)}
    .b-pend{background:rgba(247,217,76,.15);color:var(--yellow)}
    .b-dec{background:rgba(255,95,63,.15);color:var(--coral)}

    footer{border-top:1.5px solid var(--charcoal);text-align:center;padding:3rem 2rem}
    .footer-names{font-size:2rem;font-weight:300;font-style:italic;margin-bottom:.5rem}
    .footer-date{font-family:'DM Mono',monospace;font-size:.72rem;letter-spacing:.15em;text-transform:uppercase;color:#888}
    .color-bar{height:8px;background:repeating-linear-gradient(90deg,var(--coral) 0,var(--coral) 50px,var(--yellow) 50px,var(--yellow) 100px,var(--teal) 100px,var(--teal) 150px,var(--pink) 150px,var(--pink) 200px,var(--violet) 200px,var(--violet) 250px,var(--green) 250px,var(--green) 300px);margin-top:2rem}

    @media(max-width:620px){
      nav{gap:1.2rem;font-size:.65rem}
      .ev-block{grid-template-columns:1fr;gap:.3rem}
      .rsvp-box{padding:1.5rem}
      .person-events{grid-template-columns:1fr}
      .admin-stats{grid-template-columns:1fr 1fr}
      .btn-row{flex-direction:column}
    }
  </style>
</head>
<body>

<nav>
  <a href="#schedule">Schedule</a>
  <a href="#rsvp">RSVP</a>
  <a href="#travel">Travel</a>
  <a href="#admin" id="admin-nav-link">Admin ‚Üó</a>
</nav>

<!-- HERO -->
<section id="hero">
  <div class="confetti-strip"></div>
  <div class="fs s1"></div><div class="fs s2"></div><div class="fs s3"></div>
  <p class="hero-eyebrow">We're getting married</p>
  <h1 class="hero-names">Madeline<span class="amp">&amp;</span>Jake</h1>
  <div class="hero-date">Saturday, May 1, 2027 ¬∑ Austin, Texas</div>
  <p class="hero-loc">Lady Bird Johnson Wildflower Center</p>
  <div class="dc-badge">
    <strong>Dress Code: Bright &amp; Bold</strong>
    We're celebrating in color ‚Äî wear your most vibrant outfit and favorite patterns!
  </div>
</section>

<!-- SCHEDULE -->
<div class="divider"></div>
<section id="schedule">
  <p class="section-label">When &amp; Where</p>
  <h2 class="section-title">The Weekend</h2>
  <div class="sched-grid">
    <div class="ev-day">Friday, April 30th ‚Äî Welcome Party</div>
    <div class="ev-block">
      <div class="ev-time"><span class="ev-dot" style="background:var(--teal)"></span>8:00 ‚Äì 10:00 PM</div>
      <div><div class="ev-name">Welcome Party</div><div class="ev-det">La Mancha Tex Mex Tavern ¬∑ Austin, TX<br>Come kick off the weekend ‚Äî drinks, churros, happy vibes.</div></div>
    </div>
    <div class="ev-day" style="margin-top:2rem">Saturday, May 1st ‚Äî Wedding Day</div>
    <div class="ev-block">
      <div class="ev-time"><span class="ev-dot" style="background:var(--yellow)"></span>5:30 PM</div>
      <div><div class="ev-name">Guests Arrive</div><div class="ev-det">Lady Bird Johnson Wildflower Center ¬∑ 4801 La Crosse Ave, Austin TX 78739</div></div>
    </div>
    <div class="ev-block">
      <div class="ev-time"><span class="ev-dot" style="background:var(--coral)"></span>6:00 PM</div>
      <div><div class="ev-name">Ceremony</div><div class="ev-det">Please be seated before 6:00 PM ‚Äî we'll start promptly.</div></div>
    </div>
    <div class="ev-block">
      <div class="ev-time"><span class="ev-dot" style="background:var(--pink)"></span>Following Ceremony</div>
      <div><div class="ev-name">Cocktail Hour &amp; Reception</div><div class="ev-det">Dinner, dancing, and celebrating all night long.</div></div>
    </div>
    <div class="ev-block">
      <div class="ev-time"><span class="ev-dot" style="background:var(--violet)"></span>11:00 PM</div>
      <div><div class="ev-name">Send-Off</div><div class="ev-det">Reception ends ‚Äî we can't wait to celebrate with you!</div></div>
    </div>
  </div>
</section>

<!-- RSVP -->
<div class="divider"></div>
<section id="rsvp">
  <p class="section-label">Join Us</p>
  <h2 class="section-title">RSVP</h2>
  <div class="rsvp-box">

    <!-- Step 1: lookup -->
    <div class="rsvp-step active" id="s-lookup">
      <div class="form-group">
        <label for="lookup-input">Your Name</label>
        <input type="text" id="lookup-input" placeholder="e.g. Jane Smith" autocomplete="off"
          onkeydown="if(event.key==='Enter')doLookup()" />
      </div>
      <div id="lookup-alert"></div>
      <button class="btn" id="lookup-btn" onclick="doLookup()">Find My Invitation</button>
      <p class="rsvp-deadline" style="margin-top:1rem">Having trouble? Email us at madeline@jake2027.com</p>
    </div>

    <!-- Step 2: per-person form -->
    <div class="rsvp-step" id="s-form">
      <div class="inv-card" id="inv-card">
        <strong>üéâ Found your invitation!</strong>
        <div class="inv-names" id="inv-names"></div>
      </div>

      <p style="font-size:1rem;color:#555;font-style:italic;margin-bottom:1.5rem">
        Let us know who's coming to each event ‚Äî click each tile to toggle attendance.
      </p>

      <div id="person-blocks"></div>

      <!-- open +1 -->
      <div class="plus-one-box" id="plus-one-box" style="display:none">
        <div class="pob-label">üéä You have an open +1 ‚Äî are they joining you?</div>
        <div class="form-group" style="margin-bottom:.8rem">
          <label>Your guest's name</label>
          <input type="text" id="plus-one-name-input" placeholder="e.g. Jordan Lee"
            oninput="onPlusOneNameChange()" />
        </div>
        <div id="plus-one-person-block"></div>
      </div>

      <div class="form-group" style="margin-top:.5rem">
        <label>Dietary restrictions or notes <span style="opacity:.5;font-size:.85em">(for the whole group)</span></label>
        <textarea id="notes-input" placeholder="Vegetarian, nut allergy, high chair needed..."></textarea>
      </div>

      <div id="form-alert"></div>
      <div class="btn-row">
        <button class="btn" id="submit-btn" onclick="doSubmit()">Send RSVP</button>
        <button class="btn btn-ghost" onclick="doReset()">‚Üê Back</button>
      </div>
      <p class="rsvp-deadline">Please RSVP by April 1, 2027</p>
    </div>

    <!-- Step 3: success -->
    <div class="rsvp-step" id="s-success">
      <div class="success-banner">
        üéâ Thank you! Your RSVP has been received.<br>
        We can't wait to celebrate with you in Austin!
      </div>
    </div>

  </div>
</section>

<!-- TRAVEL -->
<div class="divider"></div>
<section id="travel">
  <p class="section-label">Getting Here</p>
  <h2 class="section-title">Travel &amp; Stay</h2>
  <p style="font-size:1.1rem;color:#555;font-style:italic;margin-bottom:2rem;line-height:1.6">Austin-Bergstrom International Airport (AUS) is about 25 minutes from the venue. Room blocks coming soon!</p>
  <div class="hotel-cards">
    <div class="hotel-card"><div class="hotel-name">Room Block</div><div class="hotel-meta">Details Coming Soon</div><div class="hotel-desc">We're securing a room block nearby ‚Äî check back soon for the group rate link.</div></div>
    <div class="hotel-card"><div class="hotel-name">South Austin Hotels</div><div class="hotel-meta">Near the Wildflower Center</div><div class="hotel-desc">Look along South Congress or near Slaughter Lane for the easiest access to the venue.</div></div>
    <div class="hotel-card"><div class="hotel-name">Downtown Austin</div><div class="hotel-meta">~20 min from venue</div><div class="hotel-desc">Loads of hotel and Airbnb options if you want to be in the heart of Austin.</div></div>
  </div>
  <div class="travel-note"><strong>‚úàÔ∏è Flying In?</strong>AUS is your closest airport. Rideshares are widely available. Book early ‚Äî Austin fills up fast on spring weekends!</div>
</section>

<!-- ADMIN -->
<div id="admin">
  <div class="inner">
    <p class="section-label">Admin Only</p>
    <h2 class="section-title">Guest List Manager</h2>

    <div style="margin-bottom:2rem">
      <label style="font-family:'DM Mono',monospace;font-size:.68rem;letter-spacing:.15em;text-transform:uppercase;color:rgba(255,255,255,.45);display:block;margin-bottom:.6rem">Google Apps Script URL</label>
      <div class="script-row">
        <input class="admin-input" type="text" id="script-url-input" placeholder="https://script.google.com/macros/s/.../exec"
          onkeydown="if(event.key==='Enter')saveScriptUrl()" />
        <button class="btn-outline" onclick="saveScriptUrl()">Save &amp; Connect</button>
      </div>
      <div class="sync-status" id="script-status"></div>
    </div>

    <div class="upload-zone" id="upload-zone">
      <input type="file" id="csv-input" accept=".csv" style="display:none" onchange="handleCSV(event)" />
      <div class="upload-zone-icon">üìã</div>
      <div class="upload-zone-text">
        <strong>Upload / Replace Guest List CSV</strong>
        Click to choose or drag &amp; drop
      </div>
    </div>
    <div class="csv-hint">
      One row per <em>invitation</em> (household). Columns: <code>invitation_id</code>, <code>guest_names</code>, <code>open_plus_one</code><br>
      <code>guest_names</code> ‚Äî pipe-separated list of everyone on the invite<br>
      <code>open_plus_one</code> ‚Äî <code>yes</code> or <code>no</code><br><br>
      Examples:<br>
      <code>001, Jack Goulet|Mary Grace Carter, no</code><br>
      <code>002, Tom Johnson|Sarah Johnson|Emma Johnson, no</code><br>
      <code>003, Alex Rivera, yes</code>
    </div>

    <div class="admin-stats" id="admin-stats">
      <div class="stat-box"><div class="stat-num" id="s-invited">‚Äî</div><div class="stat-label">Invited</div></div>
      <div class="stat-box"><div class="stat-num" id="s-responded" style="color:var(--green)">‚Äî</div><div class="stat-label">RSVPd</div></div>
      <div class="stat-box"><div class="stat-num" id="s-wed-yes" style="color:var(--teal)">‚Äî</div><div class="stat-label">Wedding ‚úì</div></div>
      <div class="stat-box"><div class="stat-num" id="s-wel-yes" style="color:var(--pink)">‚Äî</div><div class="stat-label">Welcome ‚úì</div></div>
      <div class="stat-box"><div class="stat-num" id="s-pending" style="color:var(--yellow)">‚Äî</div><div class="stat-label">Pending</div></div>
    </div>

    <div id="admin-controls">
      <div class="sync-status" id="sync-status"></div>
      <input class="search-bar" type="text" id="admin-search" placeholder="Search guests‚Ä¶" oninput="renderTable()" />
      <div class="admin-actions">
        <button class="btn-outline active" onclick="setFilter('all',this)">All</button>
        <button class="btn-outline" onclick="setFilter('wed-yes',this)">Wedding ‚úì</button>
        <button class="btn-outline" onclick="setFilter('wed-no',this)">Wedding ‚úó</button>
        <button class="btn-outline" onclick="setFilter('pending',this)">Pending</button>
        <button class="btn-outline" onclick="refreshFromSheet()" style="margin-left:auto">‚Üª Refresh</button>
        <button class="btn-outline" onclick="exportCSV()">‚¨á Export</button>
      </div>
      <div class="gtw">
        <table>
          <thead><tr>
            <th>Guest</th><th>Invitation</th><th>Role</th>
            <th>Wedding</th><th>Welcome Party</th><th>Notes</th>
          </tr></thead>
          <tbody id="admin-tbody"></tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<footer>
  <div class="footer-names">Madeline &amp; Jake</div>
  <div class="footer-date">May 1, 2027 ¬∑ Austin, Texas</div>
  <div class="color-bar"></div>
</footer>

<script>
// ‚îÄ‚îÄ‚îÄ CONFIG ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const ADMIN_SECRET = 'sunshine42'; // change this!
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

// State
let invitations = [];   // { id, names:[], openPlusOne:bool, responded:bool, guests:[] }
let currentInv  = null;
let activeFilter = 'all';
let scriptUrl = localStorage.getItem('mjScriptUrl') || 'https://script.google.com/macros/s/AKfycby19ooGqbZKU-4C_AdW0_ujxRJ53TGhxqxL9JfzZTFbCui0lt_gTGzuXeMmscjEP-SN_w/exec';
let isAdmin = false;

// Each person toggle state: personStates[idx] = { wedding:'yes'|'no'|null, welcome:'yes'|'no'|null }
let personStates = [];
let plusOnePersonState = null; // { wedding, welcome }

// ‚îÄ‚îÄ‚îÄ INIT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
(function init() {
  const p = new URLSearchParams(window.location.search);
  isAdmin = p.get('admin') === ADMIN_SECRET;
  if (isAdmin) {
    document.getElementById('admin').style.display = 'block';
    document.getElementById('admin-nav-link').style.display = 'inline';
    document.getElementById('admin-stats').style.display = 'grid';
    document.getElementById('admin-controls').style.display = 'block';
    if (scriptUrl) {
      document.getElementById('script-url-input').value = scriptUrl;
      refreshFromSheet();
    }
    const zone = document.getElementById('upload-zone');
    zone.addEventListener('click', () => document.getElementById('csv-input').click());
    zone.addEventListener('dragover', e => { e.preventDefault(); zone.style.borderColor = 'var(--yellow)'; });
    zone.addEventListener('dragleave', () => { zone.style.borderColor = ''; });
    zone.addEventListener('drop', e => {
      e.preventDefault(); zone.style.borderColor = '';
      const f = e.dataTransfer.files[0];
      if (f) { const r = new FileReader(); r.onload = ev => parseAndUpload(ev.target.result); r.readAsText(f); }
    });
  }
  if (scriptUrl) fetchInvitationsForRSVP();
})();

// ‚îÄ‚îÄ‚îÄ UTILS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const norm = s => (s || '').toLowerCase().trim().replace(/\s+/g, ' ');
const fmtNames = names => {
  if (names.length === 1) return names[0];
  if (names.length === 2) return names[0] + ' & ' + names[1];
  return names.slice(0, -1).join(', ') + ' & ' + names[names.length - 1];
};

// ‚îÄ‚îÄ‚îÄ APPS SCRIPT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function apsFetch(payload) {
  if (!scriptUrl) return null;
  const res = await fetch(scriptUrl + '?nc=' + Date.now(), {
    method: 'POST', body: JSON.stringify(payload),
    headers: { 'Content-Type': 'text/plain' }
  });
  return res.json();
}

function saveScriptUrl() {
  const v = document.getElementById('script-url-input').value.trim();
  if (!v.startsWith('https://script.google.com')) {
    setScriptSt('‚ö† That doesn\'t look like a valid Apps Script URL.'); return;
  }
  scriptUrl = v;
  localStorage.setItem('mjScriptUrl', scriptUrl);
  setScriptSt('Connecting‚Ä¶');
  refreshFromSheet();
}

async function refreshFromSheet() {
  setSyncSt('‚Üª Loading from Google Sheets‚Ä¶');
  try {
    const d = await apsFetch({ action: 'getInvitations' });
    if (!d || d.error) { setSyncSt('‚ö† ' + (d?.error || 'Could not load')); return; }
    invitations = d.invitations || [];
    updateStats(); renderTable();
    setSyncSt('‚úì Synced ¬∑ ' + new Date().toLocaleTimeString(), true);
    setScriptSt('‚úì Connected', true);
  } catch(e) { setSyncSt('‚ö† Connection failed ‚Äî check your URL'); }
}

async function fetchInvitationsForRSVP() {
  try {
    const d = await apsFetch({ action: 'getInvitations' });
    if (d && d.invitations) invitations = d.invitations;
  } catch(e) {}
}

function setScriptSt(msg, ok) {
  const el = document.getElementById('script-status');
  if (!el) return;
  el.textContent = msg;
  el.style.color = ok ? 'var(--green)' : 'rgba(255,255,255,.4)';
}
function setSyncSt(msg, ok) {
  const el = document.getElementById('sync-status');
  if (!el) return;
  el.textContent = msg;
  el.style.color = ok ? 'var(--green)' : 'rgba(255,255,255,.4)';
}

// ‚îÄ‚îÄ‚îÄ CSV PARSE & UPLOAD ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function handleCSV(e) {
  const f = e.target.files[0]; if (!f) return;
  const r = new FileReader();
  r.onload = ev => parseAndUpload(ev.target.result);
  r.readAsText(f);
}

function parseAndUpload(text) {
  const lines = text.trim().split('\n').filter(l => l.trim());
  const start = lines[0].toLowerCase().includes('invitation') || lines[0].toLowerCase().includes('guest') ? 1 : 0;
  const parsed = [];
  for (let i = start; i < lines.length; i++) {
    const cols = lines[i].split(',').map(c => c.trim());
    if (cols.length < 2) continue;
    const [id, namesRaw, openRaw] = cols;
    if (!id || !namesRaw) continue;
    const names = namesRaw.split('|').map(n => n.trim()).filter(Boolean);
    const openPlusOne = (openRaw || '').toLowerCase() === 'yes';
    const ex = invitations.find(inv => inv.id === id);
    parsed.push({ id, names, openPlusOne, responded: ex?.responded || false, guests: ex?.guests || [] });
  }
  invitations = parsed;
  updateStats(); renderTable();

  if (!scriptUrl) {
    setSyncSt('‚ö† Loaded locally ‚Äî add your Apps Script URL to sync to Sheets.'); return;
  }
  setSyncSt('‚è≥ Uploading to Google Sheets‚Ä¶');
  apsFetch({ action: 'setInvitations', invitations }).then(r => {
    if (r?.ok) setSyncSt('‚úì Saved to Google Sheets ¬∑ ' + new Date().toLocaleTimeString(), true);
    else setSyncSt('‚ö† Upload failed: ' + (r?.error || 'unknown'));
  }).catch(() => setSyncSt('‚ö† Could not reach Google Sheets.'));
}

// ‚îÄ‚îÄ‚îÄ ADMIN UI ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function updateStats() {
  // Count individual people (each named guest in each invitation)
  let invited = 0, responded = 0, wedYes = 0, welYes = 0, pending = 0;
  invitations.forEach(inv => {
    const gCount = inv.names.length + (inv.openPlusOne ? 1 : 0);
    invited += inv.names.length; // open +1 counted only if they showed up
    if (inv.responded) {
      responded++;
      inv.guests.forEach(g => {
        if (g.wedding === 'yes') wedYes++;
        if (g.welcome === 'yes') welYes++;
      });
    } else pending++;
  });
  document.getElementById('s-invited').textContent = invited + '+';
  document.getElementById('s-responded').textContent = responded;
  document.getElementById('s-wed-yes').textContent = wedYes;
  document.getElementById('s-wel-yes').textContent = welYes;
  document.getElementById('s-pending').textContent = pending;
}

function setFilter(f, btn) {
  activeFilter = f;
  document.querySelectorAll('.admin-actions .btn-outline').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  renderTable();
}

function renderTable() {
  const q = norm(document.getElementById('admin-search')?.value || '');
  const tbody = document.getElementById('admin-tbody');
  if (!tbody) return;

  let rows = '';
  invitations.forEach(inv => {
    // filter
    if (q && !inv.names.some(n => norm(n).includes(q)) &&
        !inv.guests.some(g => norm(g.name).includes(q))) return;
    if (activeFilter === 'wed-yes' && (!inv.responded || !inv.guests.some(g => g.wedding === 'yes'))) return;
    if (activeFilter === 'wed-no'  && (!inv.responded || inv.guests.some(g => g.wedding === 'yes'))) return;
    if (activeFilter === 'pending' && inv.responded) return;

    // invitation header row
    rows += `<tr class="inv-row"><td colspan="6">Invitation ${inv.id}${inv.openPlusOne ? ' ¬∑ open +1' : ''}</td></tr>`;

    if (!inv.responded) {
      // show expected names as pending
      inv.names.forEach(n => {
        rows += `<tr><td>${n}</td><td style="color:rgba(255,255,255,.3);font-style:italic">${inv.id}</td>
          <td><span class="badge b-pend">named</span></td>
          <td><span class="badge b-pend">Pending</span></td>
          <td><span class="badge b-pend">Pending</span></td><td>‚Äî</td></tr>`;
      });
    } else {
      inv.guests.forEach(g => {
        const wb = g.wedding === 'yes' ? `<span class="badge b-yes">Attending</span>` : `<span class="badge b-dec">Declined</span>`;
        const wl = g.welcome === 'yes' ? `<span class="badge b-yes">Yes</span>`
          : g.welcome === 'no' ? `<span class="badge b-no">No</span>`
          : `<span class="badge b-pend">‚Äî</span>`;
        const roleBadge = g.role === 'plus_one' ? `<span class="badge b-pend">+1</span>`
          : g.role === 'primary' ? `<span class="badge" style="background:rgba(255,255,255,.07);color:rgba(255,255,255,.5)">primary</span>`
          : `<span class="badge b-no">named</span>`;
        rows += `<tr><td>${g.name}</td><td style="color:rgba(255,255,255,.3);font-size:.8rem">${inv.id}</td>
          <td>${roleBadge}</td><td>${wb}</td><td>${wl}</td>
          <td style="color:rgba(255,255,255,.45);font-style:italic;font-size:.85rem;max-width:180px">${g.notes || '‚Äî'}</td></tr>`;
      });
    }
  });

  tbody.innerHTML = rows || `<tr><td colspan="6" style="text-align:center;color:rgba(255,255,255,.25);padding:2rem;font-style:italic">No guests found</td></tr>`;
}

function exportCSV() {
  const rows = [['Invitation ID','Guest Name','Role','Wedding','Welcome Party','Notes']];
  invitations.forEach(inv => {
    if (inv.responded) {
      inv.guests.forEach(g => rows.push([inv.id, g.name, g.role, g.wedding, g.welcome, g.notes || '']));
    } else {
      inv.names.forEach(n => rows.push([inv.id, n, 'named', 'pending', 'pending', '']));
      if (inv.openPlusOne) rows.push([inv.id, '(open +1)', 'plus_one', 'pending', 'pending', '']);
    }
  });
  const csv = rows.map(r => r.map(c => `"${c}"`).join(',')).join('\n');
  const a = document.createElement('a');
  a.href = 'data:text/csv;charset=utf-8,' + encodeURIComponent(csv);
  a.download = 'madeline-jake-rsvps.csv';
  a.click();
}

// ‚îÄ‚îÄ‚îÄ RSVP FLOW ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function doLookup() {
  const raw = document.getElementById('lookup-input').value.trim();
  if (!raw) { showAlert('lookup-alert', 'error', 'Please enter your name.'); return; }

  const btn = document.getElementById('lookup-btn');
  btn.disabled = true; btn.innerHTML = '<span class="spinner"></span>Looking up‚Ä¶';

  if (scriptUrl && !invitations.length) await fetchInvitationsForRSVP();
  btn.disabled = false; btn.textContent = 'Find My Invitation';

  if (!invitations.length) {
    showAlert('lookup-alert', 'error', 'RSVP isn\'t open quite yet ‚Äî check back soon or email us at madeline@jake2027.com'); return;
  }

  const q = norm(raw);
  const found = invitations.find(inv =>
    inv.names.some(n => norm(n) === q || norm(n).startsWith(q.split(' ')[0]) && norm(n).endsWith(q.split(' ').slice(-1)[0]))
  );

  if (!found) {
    showAlert('lookup-alert', 'error', 'We couldn\'t find that name on our guest list. Please double-check the spelling, or email us at madeline@jake2027.com'); return;
  }
  if (found.responded) {
    showAlert('lookup-alert', 'error', `We already have an RSVP for your invitation! Email us at madeline@jake2027.com if you need to make a change.`); return;
  }

  currentInv = found;
  buildForm(found);
}

function buildForm(inv) {
  // invitation card
  document.getElementById('inv-names').textContent = fmtNames(inv.names);

  // build per-person blocks
  personStates = inv.names.map(() => ({ wedding: null, welcome: null }));
  plusOnePersonState = null;

  const container = document.getElementById('person-blocks');
  container.innerHTML = inv.names.map((name, i) => personBlockHTML(name, i, i === 0 ? 'primary' : 'named')).join('');

  // open +1 section
  document.getElementById('plus-one-box').style.display = inv.openPlusOne ? 'block' : 'none';
  document.getElementById('plus-one-name-input').value = '';
  document.getElementById('plus-one-person-block').innerHTML = '';

  showStep('s-form');
}

function personBlockHTML(name, idx, role, isPlusOne = false) {
  const prefix = isPlusOne ? 'po' : `p${idx}`;
  const roleLabel = role === 'primary' ? 'primary guest' : role === 'plus_one' ? '+1' : 'guest';
  return `<div class="person-block" id="block-${prefix}">
    <div class="person-header">
      <span>${name}</span>
      <span class="person-role">${roleLabel}</span>
    </div>
    <div class="person-body">
      <div class="person-events">
        <div>
          <div style="font-family:'DM Mono',monospace;font-size:.65rem;letter-spacing:.1em;text-transform:uppercase;color:#888;margin-bottom:.5rem">Wedding ¬∑ May 1</div>
          <div style="display:flex;gap:.5rem">
            <div class="event-toggle" id="${prefix}-wed-yes" onclick="setToggle('${prefix}','wedding','yes')">
              <span class="ev-label">Attending</span>
              <span class="ev-answer">‚úì Yes</span>
            </div>
            <div class="event-toggle" id="${prefix}-wed-no" onclick="setToggle('${prefix}','wedding','no')">
              <span class="ev-label">Not attending</span>
              <span class="ev-answer">‚úó No</span>
            </div>
          </div>
        </div>
        <div>
          <div style="font-family:'DM Mono',monospace;font-size:.65rem;letter-spacing:.1em;text-transform:uppercase;color:#888;margin-bottom:.5rem">Welcome Party ¬∑ Apr 30</div>
          <div style="display:flex;gap:.5rem">
            <div class="event-toggle" id="${prefix}-wel-yes" onclick="setToggle('${prefix}','welcome','yes')">
              <span class="ev-label">Attending</span>
              <span class="ev-answer">‚úì Yes</span>
            </div>
            <div class="event-toggle" id="${prefix}-wel-no" onclick="setToggle('${prefix}','welcome','no')">
              <span class="ev-label">Not attending</span>
              <span class="ev-answer">‚úó No</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>`;
}

function setToggle(prefix, event, val) {
  // update visual
  const yesEl = document.getElementById(`${prefix}-${event === 'wedding' ? 'wed' : 'wel'}-yes`);
  const noEl  = document.getElementById(`${prefix}-${event === 'wedding' ? 'wed' : 'wel'}-no`);
  yesEl.className = 'event-toggle' + (val === 'yes' ? ' selected-yes' : '');
  noEl.className  = 'event-toggle' + (val === 'no'  ? ' selected-no'  : '');

  // update state
  if (prefix === 'po') {
    if (!plusOnePersonState) plusOnePersonState = { wedding: null, welcome: null };
    plusOnePersonState[event] = val;
  } else {
    const idx = parseInt(prefix.slice(1));
    personStates[idx][event] = val;
  }
}

function onPlusOneNameChange() {
  const name = document.getElementById('plus-one-name-input').value.trim();
  const container = document.getElementById('plus-one-person-block');
  if (name.length > 1) {
    if (!container.innerHTML) {
      container.innerHTML = personBlockHTML(name, 0, 'plus_one', true);
      plusOnePersonState = { wedding: null, welcome: null };
    } else {
      // update displayed name without wiping toggles
      const header = container.querySelector('.person-header span:first-child');
      if (header) header.textContent = name;
    }
  } else {
    container.innerHTML = '';
    plusOnePersonState = null;
  }
}

async function doSubmit() {
  // validate: every person must have answered both events
  for (let i = 0; i < personStates.length; i++) {
    const name = currentInv.names[i];
    if (!personStates[i].wedding) {
      showAlert('form-alert', 'error', `Please select wedding attendance for ${name}.`); return;
    }
    if (!personStates[i].welcome) {
      showAlert('form-alert', 'error', `Please select welcome party attendance for ${name}.`); return;
    }
  }
  if (plusOnePersonState !== null) {
    const poName = document.getElementById('plus-one-name-input').value.trim();
    if (!poName) { showAlert('form-alert', 'error', 'Please enter your guest\'s name, or leave the +1 field blank.'); return; }
    if (!plusOnePersonState.wedding) { showAlert('form-alert', 'error', `Please select wedding attendance for ${poName}.`); return; }
    if (!plusOnePersonState.welcome) { showAlert('form-alert', 'error', `Please select welcome party attendance for ${poName}.`); return; }
  }

  const notes = document.getElementById('notes-input').value.trim();
  const btn = document.getElementById('submit-btn');
  btn.disabled = true; btn.innerHTML = '<span class="spinner"></span>Saving‚Ä¶';

  // build guests array
  const guests = currentInv.names.map((name, i) => ({
    name, role: i === 0 ? 'primary' : 'named',
    wedding: personStates[i].wedding,
    welcome: personStates[i].welcome,
    notes: i === 0 ? notes : ''
  }));

  if (plusOnePersonState) {
    guests.push({
      name: document.getElementById('plus-one-name-input').value.trim(),
      role: 'plus_one',
      wedding: plusOnePersonState.wedding,
      welcome: plusOnePersonState.welcome,
      notes: ''
    });
  }

  currentInv.responded = true;
  currentInv.guests = guests;

  if (scriptUrl) {
    try {
      await apsFetch({ action: 'saveRsvp', invitationId: currentInv.id, guests, notes });
    } catch(e) {}
  }

  if (isAdmin) { updateStats(); renderTable(); }
  showStep('s-success');
}

function doReset() {
  currentInv = null; personStates = []; plusOnePersonState = null;
  document.getElementById('lookup-input').value = '';
  document.getElementById('lookup-alert').innerHTML = '';
  document.getElementById('form-alert').innerHTML = '';
  showStep('s-lookup');
}

function showStep(id) {
  document.querySelectorAll('.rsvp-step').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function showAlert(id, type, msg) {
  document.getElementById(id).innerHTML =
    `<div class="alert alert-${type === 'error' ? 'error' : 'info'}">${msg}</div>`;
}
</script>
</body>
</html>
